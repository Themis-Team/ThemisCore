<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Loading Lato Font -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
  <!-- Loading Font Awesome -->
  <link rel="stylesheet" href="../fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  <!-- Doxygen version -->
  <meta name="generator" content="Doxygen 1.8.13"/>
  <!--PROJECT_NAME-->
  <title>Themis Documentation</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
  <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet"> -->
  <link href="../bootstrap/css/sticky-footer-navbar.css" rel="stylesheet">
  <link href="../bootstrap/css/customdoxygen.css" rel="stylesheet">
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>
  <!-- <script type="text/javascript" src="../bootstrap/js/doxy-boot.js"></script> -->
</head>
<body screen_capture_injected="true">
  <!-- Wrap all page content here -->
  <div id="wrap">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse" role="navigation">
    <!-- Fixed top navbar
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation"> 
    -->
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand hidden-sm" href="index.html">
        <p style="color:white; font-size:160%; font-family:serif, fantasy; font-variant: small-caps; color:DEEPSKYBLUE">Themis</p></a>
        <a class="navbar-brand visible-sm" style='margin-left: -30px !important;width: 60px !important;' href="index.html"><p>THEMIS</p></a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav adjust-right">
          <li><a href="index.html"> Home</a></li>
          <li><a href="About.html">About</a></li>
          <li><a href="GetStarted.html">Get Started</a></li>
          <li><a href="Contribute.html">Contribute</a></li>
          <li><a href="index.html">Documentation</a></li>
          <li><a href="https://github.com/PerimeterInstitute/Themis">Download</a></li>
          <li><a href="http://www.eventhorizontelescope.org/">EHT</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
    </nav>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
            <div style="margin-bottom: 15px;">
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Contribute </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Welcome to the Themis development team! Without you, Themis doesn't work!</p>
<h2>Themis design philosophy </h2>
<p>Themis is a <em>framework</em>, and is therefore designed to be adaptable and easily applied. Therefore, the key philosophical considerations in its design are that it must be:</p>
<p><b>Modular</b>: Users should only ever need to know the inner workings of their particular piece. It should never be necessary for any user to be an expert on all parts of the code for it to work.</p>
<p><b>Flexible</b>: Parts should be interchangeable where possible. For example, one model should be able to be swapped for another without needing to modify the data, likelihoods, or sampler.</p>
<p><b>Extensible</b>: Contributors should be able to add functionality to Themis easily, without understanding in detail large parts of the code. This also means that it must be sufficiently well documented that everyone knows what each piece does without having to resort to reading the source code.</p>
<p><b>Rigorous</b>: Components of Themis must ultimately undergo validation testing. This process is greatly simplified if each component is rigorously tested during creation. While no component testing regime can eliminate all bugs, producing test routines concurrently with code generation can greatly reduce them.</p>
<h2>Themis structure and coding guidelines </h2>
<p>Themis is written in C++, which naturally facilitates modularity and flexibility. As with any programming language, C++ admits many styles choices. Here we discuss some of the choices that have been made with Themis.</p>
<p><b>Structure</b></p>
<p>Themis itself has been organized into five directories, each of which hold different kinds of code elements:</p>
<ul>
<li><a href="files.html">data</a>: These are types of data. Each data type has a datum struct (e.g., <a class="el" href="a01907.html" title="Defines a struct containing individual visibility amplitudes and ancillary information. ">Themis::datum_visibility_amplitude</a>) and a data class (e.g., <a class="el" href="a01911.html" title="Defines a class containing a collection of visibility amplitude datum objects with simple I/O...">Themis::data_visibility_amplitude</a>), where the latter has I/O functions that permit the reading and manipulation of many individual datum objects. Anything that is directly measured should ultimately be a data object.</li>
<li><a href="files.html">model</a>: These are various models that produce theoretical predictions for the kinds of data found in <em>data</em>. Note that not all models can produce all kinds of data. All models are, however, based on a prototypical abstract base class associated with each data type, e.g., <a class="el" href="a02379.html" title="Defines the interface for models that generate visibility amplitude data appropriate for comparison w...">Themis::model_visibility_amplitude</a>. Models can, naturally, be based on more than one such class. Anything that makes a prediction should be a model object.</li>
<li><a href="files.html">likelihood</a>: These provide a means to directly compare models with data to produce log-likelihoods and \(\chi^2\)'s. These may be simply a sum of the squares (e.g., <a class="el" href="a02039.html" title="Defines a class that constructs a visibility amplitude likelihood object. ">Themis::likelihood_visibility_amplitude</a>) or may be more sophisticated expressions that analytically optimize over a subset of nuisance parameters (e.g., <a class="el" href="a02003.html" title="Defines a class that constructs a marginalized visibility amplitude likelihood object. ">Themis::likelihood_marginalized_visibility_amplitude</a>). In addition, parameter priors and transforms are located here.</li>
<li><a href="files.html">sampling</a>: These are schemes for sampling likelihoods over a given parameter space.</li>
<li><a href="files.html">util</a>: This contains a collection of utility functions that are used by other elements of the code but do not properly belong in one of the foregoing categories, e.g., <a class="el" href="a01478.html" title="Provides a list of constants (in cgs) to be used throughout Themis. ">constants.h</a>.</li>
</ul>
<p>The remaining directories contain drivers, i.e., files that produce executables that use Themis, or analysis tools.</p>
<p>Within each source directory, we have followed a file naming scheme that makes clear what kind of object is defined within. For example, a <a class="el" href="a02219.html" title="Defines an image model based on the RIAF models employed in Broderick, Fish, Doeleman and Loeb (2011)...">Themis::model_image_riaf</a> is a RIAF model based upon the <a class="el" href="a02123.html" title="Defines an interface for models that generate image data with a collection of utility functions to co...">Themis::model_image</a> class; whereas <a class="el" href="a02359.html" title="Defines an image and flux model based on the RIAF models employed in Broderick, Fish, Doeleman and Loeb (2011) and Broderick et al. (2016), permitting greater freedom to modify the underlying semi-analytic accretion flow structure. ">Themis::model_riaf</a> is a RIAF model that is not based solely on the <a class="el" href="a02123.html" title="Defines an interface for models that generate image data with a collection of utility functions to co...">Themis::model_image</a> class since it also provides a flux prediction. While the documentation does provide an index of where each class definition may be found, having descriptive file names simplifies code maintenance.</p>
<p>In addition the Vacuum Ray Tracing and Radiative Transfer routine library (VRT2) is provided. This is the code used to generate the RIAF image libraries utilized in <a href="http://adsabs.harvard.edu/abs/2016ApJ...820..137B">Broderick et al. (2016)</a> and prior publications.</p>
<p><b>Guidelines</b></p>
<p>We recommend the <a href="https://google.github.io/styleguide/cppguide.html">Google style guide</a> to novice and experienced coders alike, which discusses many C++ style choices. With regard to Themis, we have a few guidelines of our own to maintain extensibility.</p>
<ul>
<li><em>Always</em> use define guards on header files. These should have the form Themis_&lt;file name&gt;_H_. This prevents reading in the same header file multiple times (an error in C++ compilation).</li>
<li><em>Always</em> use the Themis namespace. You can do this by encapsulating your code in "using namespace Themis { ... };". <em>Never</em> use "using namespace ...", which tends to lead to namespace collisions in large codes.</li>
<li><em>Always</em> separate declarations and implementations into header (.h) and source (.cpp) files, <em>except</em> when the function is "inline" or an abstract template.</li>
<li><em>Everywhere possible</em> use the "const" keyword to indicate things that <em>should</em> never change.</li>
<li><em>Everywhere possible</em> make class members private unless there is an overwhelming reason to permit it to be public.</li>
<li><em>Everywhere possible</em> create new classes from old classes to inherit their interface. This is especially true for models, which should make use of the abstract base classes which define their interfaces.</li>
<li><em>Where possible</em> compile functions directly into Themis (i.e., make sparing use of "std::system"). Many codes are not implemented in C++ (or C) and thus compiling them directly into Themis is nontrivial. We have made use of "std::system" to run executables generated via other programs (e.g., <a class="el" href="a02131.html" title="Defines an interface to ASTRORAY to produce and read in images model based on the model_image class...">Themis::model_image_astroray</a>). While convenient and simple, this limits the extensibility by forcing the entire interface to run through a single external executable.</li>
<li><em>Usually</em> it is better to use longer, descriptive class names rather than short, obscure abbreviations. Similarly, use descriptive variable names* to avoid confusion in the future.</li>
<li><em>Always</em> prepend an underscore (i.e., "_") to class variables to indicate that they are defined beyond a given function (and may change!).</li>
<li><em>Always</em> error on the side of too many comments! That's a joke, you can never have too many comments!</li>
<li><em>Always</em> be transparent and verbose about choices that are made within the code.</li>
<li><em>Small and simple</em> code fragments are easier to understand and more likely to be correct than <em>large and complex</em> code soup.</li>
<li><em>Always</em> make sure that new code is MPI-safe, i.e., can be run on multiple processors without obvious failures. Note that this does not mean it must be parallelized! If you wish to implement MPI directives, <em>always</em> use C-style bindings.</li>
<li><em>Always</em> include header files only in the files where they are required. <em>All</em> files should be header-complete, i.e., no files should anticipate some set of headers will be included upstream.</li>
<li><em>Never</em> link to proprietary commercial software if a widespread, free option exists. Themis must work on a variety of platforms spread across many continents. If possible, provide all functions within Themis itself.</li>
<li><em>Always</em> provide clear documentation of every public class function (see the documentation requirements below). This includes a file-specific comment at the beginning of every file describing its purpose and contents. <em>Always</em> pay attention to the Doxygen comment rules to avoid documentation errors.</li>
<li><em>Never</em> submit broken code or code that modifies pre-existing test performance.</li>
</ul>
<h2>Parallelization </h2>
<p>Themis currently supports parallelization with MPI. This has been implemented flexibly, permitting independent parallel execution at multiple levels, including</p><ul>
<li>Within the sampler</li>
<li>Within the likelihood computation</li>
<li>Within the model generation</li>
</ul>
<p>These have been organized via the distribution of MPI Communicators passed to each level of the computation (sampler to likelihood to model), permitting each to organize the set of processes the next will execute upon. A practical example may be found in <a class="el" href="a00659.html" title="Example illustrating the use of the RIAF model. ">riaf_model_fitting.cpp</a>, which splits the number of processes multiple times within the sampler (into tempering levels and then among individual walkers) and then passes collections of processors to the likelihoods which then use those to parallely generate images.</p>
<p>Support for OpenMP has not yet been tested.</p>
<h2>Documentation requirements </h2>
<p>Good documentation is critical to facilitating the EHTC's use and development of Themis. Thus, documentation should not be relegated to the status of necessary evil, but rather considered a critical programming task. Themis uses <a href="http://www.doxygen.org/">Doxygen</a> to automatically produce this documentation. This has the great advantage of closely tying the code and documentation together. However, it does place some specific requirements on the way in which the source code is documented.</p>
<p>The <a href="../Doxygen-QuickReference.pdf">Doxygen Quick Reference sheet</a> provides a short primer on the key Doxygen documentation directives. An example implementation of these rules can be found in <a class="el" href="a01289.html" title="Header file for visibility ampitude model class. ">model_visibility_amplitude.h</a> and <a class="el" href="a01286.html" title="Implements visibility ampitude model class. ">model_visibility_amplitude.cpp</a> for C++ header and source files, and <a class="el" href="a01751.html" title="Python script to generate triangle, trace, log-likelihoood and chi2 plots. ">plots.py</a> for python script files.</p>
<p>In summary:</p>
<ul>
<li>All files must have a Doxygen preamble that lists the file name, author, date created, and a brief description for what the file contains.</li>
<li>Each class definition must have a preceding Doxygen comment that gives a brief and detailed description of what the class is.</li>
<li>Each public class function must have a short description describing its purpose, inputs, and outputs.</li>
</ul>
<p>Doxygen recognizes these comments via their specific format, </p><pre class="fragment">/*!
  &lt;comment&gt;
*/
</pre><p> or </p><pre class="fragment">/// &lt;comment&gt;
</pre><p> neither of which should be used otherwise. In addition, within these comments there are a number of key words, e.g., </p><pre class="fragment">\file, \author, \date, \brief, \details, \warning, etc.,
</pre><p> that describe specific elements of the documentation.</p>
<h2>Starting your Themis project </h2>
<p>Information about example Themis drivers, which step through the typical steps for setting up and running a parameter estimation analysis of EHT data, can be found on the <a class="el" href="a02751.html">Examples and Tests page</a>.</p>
<p>Prior to beginning a new project, you should pull the latest develop branch from <a href="https://github.com/PerimeterInstitute/Themis/tree/develop">github</a>; should you need access to the repository contact Avery E. Broderick (<a href="#" onclick="location.href='mai'+'lto:'+'abr'+'od'+'eri'+'ck'+'@pe'+'ri'+'met'+'er'+'ins'+'ti'+'tut'+'e.'+'ca'; return false;">abrod<span style="display: none;">.nosp@m.</span>eric<span style="display: none;">.nosp@m.</span>k@per<span style="display: none;">.nosp@m.</span>imet<span style="display: none;">.nosp@m.</span>erins<span style="display: none;">.nosp@m.</span>titu<span style="display: none;">.nosp@m.</span>te.ca</a>). You may create a new development subbranch for your project via the branch button on the left: simply enter your new branch name and you are ready to go. When you are confident that your contribution works and is properly documented, you may make a pull request to have it incorporated back into the develop branch. Note that a cursory review will be made at that time to ensure that all previous functionality remains unchanged, the coding guidelines are adhered to, and proper documentation has been supplied prior to inclusion.</p>
<h2>Getting help </h2>
<p>The Themis Development Team is here to help! If you need assistance, please <a class="el" href="a02747.html">contact us</a>. </p>
</div></div><!-- contents -->
<!--END GENERATE_TREEVIEW-->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
  <div class="container">
  <div class='row text-muted'>
    <div class='footer-row col-md-8'>Copyright &copy; 2020 <a href='Developers.html'>Themis Development Team.</a> All Rights Reserved. </div>
    <div class='footer-row col-md-1'><a href='Developers.html'>Contact</a></div>
  </div>
  </div>
  </div>
  <script>
    $(function(){
        $('.cse-search').change(function(){
            $('.adjust-right li.active').focus();
		});
		$('.cse-search').on('click', function(){
			if($(this).hasClass('active')){
				$(this).removeClass('active');
				$('.google-cse').slideUp();
			} else {
				$(this).addClass('active');
				$('.google-cse').hide().removeClass('hide').slideDown();
			}
		});
	});
  </script>
</body>
</html>
