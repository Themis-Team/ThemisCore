<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Loading Lato Font -->
  <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic' rel='stylesheet' type='text/css'>
  <!-- Loading Font Awesome -->
  <link rel="stylesheet" href="../fonts/font-awesome-4.7.0/css/font-awesome.min.css">
  <!-- Doxygen version -->
  <meta name="generator" content="Doxygen 1.8.5"/>
  <!--PROJECT_NAME-->
  <title>Themis Documentation</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
  <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet"> -->
  <link href="../bootstrap/css/sticky-footer-navbar.css" rel="stylesheet">
  <link href="../bootstrap/css/customdoxygen.css" rel="stylesheet">
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>
  <!-- <script type="text/javascript" src="../bootstrap/js/doxy-boot.js"></script> -->
</head>
<body screen_capture_injected="true">
  <!-- Wrap all page content here -->
  <div id="wrap">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse" role="navigation">
    <!-- Fixed top navbar
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation"> 
    -->
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand hidden-sm" href="index.html">
        <p style="color:white; font-size:160%; font-family:serif, fantasy; font-variant: small-caps; color:DEEPSKYBLUE">Themis</p></a>
        <a class="navbar-brand visible-sm" style='margin-left: -30px !important;width: 60px !important;' href="index.html"><p>THEMIS</p></a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav adjust-right">
          <li><a href="index.html"> Home</a></li>
          <li><a href="About.html">About</a></li>
          <li><a href="GetStarted.html">Get Started</a></li>
          <li><a href="Contribute.html">Contribute</a></li>
          <li><a href="index.html">Documentation</a></li>
          <li><a href="https://github.com/PerimeterInstitute/Themis">Download</a></li>
          <li><a href="http://www.eventhorizontelescope.org/">EHT</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
    </nav>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <div class="content" id="content">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 panel panel-default" style="padding-bottom: 15px;">
            <div style="margin-bottom: 15px;">
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="Tests.html"><span>Tests&#160;&&#160;Examples</span></a></li>
      <li><a href="Analyses.html"><span>Analyses</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_87403182fd4541df302009a04eb5ad50.html">examples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">eggbox_mcmc_sampling.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Example of how to use the Affine invariant parallel tempered MCMC sampling routine.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="a00468.html">likelihood.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="a00704.html">sampler_affine_invariant_tempered_MCMC.h</a>&quot;</code><br/>
<code>#include &lt;mpi.h&gt;</code><br/>
<code>#include &lt;memory&gt;</code><br/>
<code>#include &lt;string&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for eggbox_mcmc_sampling.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="a01037.png" border="0" usemap="#examples_2eggbox__mcmc__sampling_8cpp" alt=""/></div>
<map name="examples_2eggbox__mcmc__sampling_8cpp" id="examples_2eggbox__mcmc__sampling_8cpp">
<area shape="rect" id="node2" href="a00468.html" title="Header file for the Likelihood class. " alt="" coords="31,187,129,213"/><area shape="rect" id="node5" href="a00704.html" title="Header file for sampler_affine_invariant_tempered_MCMC class. " alt="" coords="77,97,261,138"/></map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0ddf1224851353fc92bfbff6f499fa97"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00439.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr class="separator:a0ddf1224851353fc92bfbff6f499fa97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Mansour Karami </dd></dl>
<dl class="section date"><dt>Date</dt><dd>May 2017</dd></dl>
<p>In <a class="el" href="a00789.html">Themis</a>, we can use any number of sampling routines to sample the posterior probability distribution function in the parameter space associated with any model. Affine invariant parallel tempered MCMC (Markov Chain Monte Carlo) is one such routine. It runs an ensemble of MCMC chains that collectively sample the posterior distribution. It also has the ability to use parallel tempering to facilitate sampling multi-modal distributions. The sampler needs a <a class="el" href="a00789.html">Themis</a> likelihood object in order to sample the posterior distribution. In the following example we use a five dimensional egg-box likelihood which is a multimodal distribution with 3125 peaks within the prior region.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a00468.html">likelihood.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="a00704.html">sampler_affine_invariant_tempered_MCMC.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="a00207.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>* argv[])</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Initialize MPI</span></div>
<div class="line">  MPI_Init(&amp;argc, &amp;argv);</div>
<div class="line">  <span class="keywordtype">int</span> world_rank;</div>
<div class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</div>
<div class="line"></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;MPI Initiated - Processor Node: &quot;</span> &lt;&lt; world_rank &lt;&lt; <span class="stringliteral">&quot; executing main.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Container of base prior class pointers</span></div>
<div class="line">  std::vector&lt;Themis::prior_base*&gt; P;</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//Dynamically allocate a prior for each variable and add it to the container</span></div>
<div class="line">  <span class="comment">//Here we are using a flat prior for all the parameters and confine them </span></div>
<div class="line">  <span class="comment">//to the interval [-2.5*pi, 2.5*pi]</span></div>
<div class="line">  P.push_back(<span class="keyword">new</span> <a class="code" href="a00165.html">Themis::prior_linear</a>(-2.5*M_PI, 2.5*M_PI));</div>
<div class="line">  P.push_back(<span class="keyword">new</span> <a class="code" href="a00165.html">Themis::prior_linear</a>(-2.5*M_PI, 2.5*M_PI));</div>
<div class="line">  P.push_back(<span class="keyword">new</span> <a class="code" href="a00165.html">Themis::prior_linear</a>(-2.5*M_PI, 2.5*M_PI));</div>
<div class="line">  P.push_back(<span class="keyword">new</span> <a class="code" href="a00165.html">Themis::prior_linear</a>(-2.5*M_PI, 2.5*M_PI));</div>
<div class="line">  P.push_back(<span class="keyword">new</span> <a class="code" href="a00165.html">Themis::prior_linear</a>(-2.5*M_PI, 2.5*M_PI));</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">//Set the variable transformations.</span></div>
<div class="line">  <span class="comment">//Here we are using no coordonated transformations on the parameters</span></div>
<div class="line">  std::vector&lt;Themis::transform_base*&gt; T;</div>
<div class="line">  T.push_back(<span class="keyword">new</span> <a class="code" href="a00187.html">Themis::transform_none</a>());</div>
<div class="line">  T.push_back(<span class="keyword">new</span> <a class="code" href="a00187.html">Themis::transform_none</a>());</div>
<div class="line">  T.push_back(<span class="keyword">new</span> <a class="code" href="a00187.html">Themis::transform_none</a>());</div>
<div class="line">  T.push_back(<span class="keyword">new</span> <a class="code" href="a00187.html">Themis::transform_none</a>());</div>
<div class="line">  T.push_back(<span class="keyword">new</span> <a class="code" href="a00187.html">Themis::transform_none</a>());</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//Set the likelihood functions</span></div>
<div class="line">  std::vector&lt;Themis::likelihood_base*&gt; <a class="code" href="a00461.html#a2442c8274ae11905a74c1bf95501af09">L</a>;</div>
<div class="line">  L.push_back(<span class="keyword">new</span> <a class="code" href="a00057.html">Themis::likelihood_eggbox</a>(5.0));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//Set the weights for likelihood functions</span></div>
<div class="line">  std::vector&lt;double&gt; W(1, 1.0);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//Make a likelihood object</span></div>
<div class="line">  <a class="code" href="a00050.html">Themis::likelihood</a> L_obj(P, T, L, W);</div>
<div class="line">  </div>
<div class="line"></div>
<div class="line">  <span class="comment">//Making a Themis sampler object. Here the affine invariant tempered </span></div>
<div class="line">  <span class="comment">//Markov Chain Monte Carlo method is used. The seed of the random number </span></div>
<div class="line">  <span class="comment">//generator is passed to the constructor.</span></div>
<div class="line">  <a class="code" href="a00171.html">Themis::sampler_affine_invariant_tempered_MCMC</a> MC_obj(42);</div>
<div class="line"></div>
<div class="line">  </div>
<div class="line">  <span class="comment">//The means and standard deviations used to initialize the MCMC walkers.</span></div>
<div class="line">  <span class="comment">//For each parameter the walkers would be drawn from a gaussian distribution</span></div>
<div class="line">  <span class="comment">//with the given mean and standard deviation. This provides the starting point</span></div>
<div class="line">  <span class="comment">//for the walkers.</span></div>
<div class="line">  std::vector&lt;double&gt; means, ranges;</div>
<div class="line">  means.push_back(0.0);</div>
<div class="line">  means.push_back(0.0);</div>
<div class="line">  means.push_back(0.0);</div>
<div class="line">  means.push_back(0.0);</div>
<div class="line">  means.push_back(0.0);</div>
<div class="line">  </div>
<div class="line">  ranges.push_back(1.0);</div>
<div class="line">  ranges.push_back(1.0);</div>
<div class="line">  ranges.push_back(1.0);</div>
<div class="line">  ranges.push_back(1.0);</div>
<div class="line">  ranges.push_back(1.0);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">// vector to hold the name of variables, if the names are provided it would  </span></div>
<div class="line">  <span class="comment">// be added as the header to the chain file</span></div>
<div class="line">  std::vector&lt;std::string&gt; var_names;</div>
<div class="line">  var_names.push_back(<span class="stringliteral">&quot;test_parameter1&quot;</span>);</div>
<div class="line">  var_names.push_back(<span class="stringliteral">&quot;test_parameter2&quot;</span>);</div>
<div class="line">  var_names.push_back(<span class="stringliteral">&quot;test_parameter3&quot;</span>);</div>
<div class="line">  var_names.push_back(<span class="stringliteral">&quot;test_parameter4&quot;</span>);</div>
<div class="line">  var_names.push_back(<span class="stringliteral">&quot;test_parameter5&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">int</span> Number_of_chains = 100;      <span class="comment">// Number of walkers at each temperature</span></div>
<div class="line">  <span class="keywordtype">int</span> Number_of_temperatures = 5;  <span class="comment">// Number of temperatures in the parallel tempering</span></div>
<div class="line">  <span class="keywordtype">int</span> cpu_per_likelihood = 1;      <span class="comment">// Number of processes used to evaluate a single likelihood </span></div>
<div class="line">  <span class="keywordtype">int</span> Number_of_steps = 8000;      <span class="comment">// Number of monte carlo steps </span></div>
<div class="line">  <span class="keywordtype">int</span> temp_stride = 50;            <span class="comment">// Number of MCMC steps for communication among neighbouring temperatures   </span></div>
<div class="line">  <span class="keywordtype">int</span> chi2_stride = 10000;         <span class="comment">// Frequency of calculating chi squared values</span></div>
<div class="line">  <span class="keywordtype">int</span> ckpt_stride = 100;           <span class="comment">// Frequency of saving checkpoints</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Set the cpu distribution on different parallelization levels</span></div>
<div class="line">  MC_obj.set_cpu_distribution(Number_of_temperatures, Number_of_chains, cpu_per_likelihood);</div>
<div class="line">  <span class="comment">// Set checkpointing options</span></div>
<div class="line">  MC_obj.set_checkpoint(ckpt_stride, <span class="stringliteral">&quot;sampler.ckpt&quot;</span>);</div>
<div class="line">  <span class="comment">// Run the sampler with the given settings</span></div>
<div class="line">  MC_obj.run_sampler(L_obj, Number_of_steps, </div>
<div class="line">                    temp_stride, chi2_stride, <span class="stringliteral">&quot;chain.dat&quot;</span>, <span class="stringliteral">&quot;lklhd.dat&quot;</span>, <span class="stringliteral">&quot;chi2.dat&quot;</span>, </div>
<div class="line">                    means, ranges, var_names, <span class="keyword">false</span>);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Finalize MPI</span></div>
<div class="line">  MPI_Finalize();</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">  </div>
<div class="line">}</div>
</div><!-- fragment --> </div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="a00439_a0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#a00439_a0ddf1224851353fc92bfbff6f499fa97_cgraph" alt=""/></div>
<map name="a00439_a0ddf1224851353fc92bfbff6f499fa97_cgraph" id="a00439_a0ddf1224851353fc92bfbff6f499fa97_cgraph">
<area shape="rect" id="node2" href="a00171.html#a2b7bcf7f729848cefc6d3280cb7a0ea5" title="Function to set the distribution of processors in different layers of parallelization. " alt="" coords="110,5,314,61"/><area shape="rect" id="node3" href="a00171.html#a4850ede31f84edca137aa4b7be6ac907" title="Function to set the checkpoint/restart functionality. " alt="" coords="110,85,314,141"/><area shape="rect" id="node4" href="a00171.html#a33b4d7c112a828ca94a5ee5294953620" title="Function to run the sampler, takes a likelihood object, name of output files, and tuning parameters f..." alt="" coords="110,165,314,221"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!--END GENERATE_TREEVIEW-->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer">
  <div class="container">
  <div class='row text-muted'>
    <div class='footer-row col-md-8'>Copyright &copy; 2020 <a href='Developers.html'>Themis Development Team.</a> All Rights Reserved. </div>
    <div class='footer-row col-md-1'><a href='Developers.html'>Contact</a></div>
  </div>
  </div>
  </div>
  <script>
    $(function(){
        $('.cse-search').change(function(){
            $('.adjust-right li.active').focus();
		});
		$('.cse-search').on('click', function(){
			if($(this).hasClass('active')){
				$(this).removeClass('active');
				$('.google-cse').slideUp();
			} else {
				$(this).addClass('active');
				$('.google-cse').hide().removeClass('hide').slideDown();
			}
		});
	});
  </script>
</body>
</html>
